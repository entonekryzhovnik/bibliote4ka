#### Задача:

Онлайн-библиотека с **админ-доступом** и **middleware для авторизации**.

### Требования:

#### 1. Модель данных (PostgreSQL)

go

Copy

Download

```go
type Book struct {
    ID          string    `json:"id"`           // UUID
    Title       string    `json:"title"`        // Обязательное, длина > 0
    Author      string    `json:"author"`       // Обязательное, длина > 0
    Published   int       `json:"published"`    // Год издания > 0
    Pages       int       `json:"pages"`        // > 0
    Status      string    `json:"status"`       // enum: "available", "taken"
    TakenBy     *string   `json:"taken_by"`     // email (если взята)
    CreatedAt   time.Time `json:"created_at"`  
    UpdatedAt   time.Time `json:"updated_at"`  
}
```

#### 2. Эндпоинты

**Публичные (доступны всем):**

- GET /books – список книг с фильтрами:
  - ?status=available
  - ?author=Толстой
- GET /books/{id} – получить книгу по ID.
- POST /books/{id}/take – взять книгу (требует email в теле).
- POST /books/{id}/return – вернуть книгу.

**Админские (требуют заголовок X-Admin-Secret: ваш_секретный_ключ):**

- POST /books – добавить книгу.
- PUT /books/{id} – обновить книгу (все поля, кроме status и taken_by).
- DELETE /books/{id} – удалить книгу (только если status=available).

#### 3. Middleware

- Проверяет заголовок X-Admin-Secret для админских ручек.
- Если заголовка нет или он неверный – возвращает 401 Unauthorized.

#### 4. Валидация

- Год издания не может быть будущим.
- При взятии книги проверять валидность email.
- При удалении – проверять status=available.

---

### 5. План разработки:

Сервис должен иметь стандартный набор слоев , то есть 
Middleware --→ Handler ---→ Service ---→ Repository

Я дал тебе структуру книги, ты можешь начать со слоя репозитория, попросив курсор (или сама) реализовать CRUD для структуры выше, то есть методы базы данных которые позволяют делать CREATE READ UPDATE DELETE, например BookCreate, BookList, BookUpdate и прочее, затем добавь методы которые позволяют “брать” и “возвращать” книгу (обновлять ее статус)

Должен быть интерфейс слоя базы данных и структура с методами, которая этому интерфейсу удовлетворяет 

А в структуре сервиса содержится интерфейс базы данных, куда ты передаешь свою структуру репозитория в конструкторе (метод типа NewService), так как эта структура удовлетворяет твоему интерфейсу базы данных. Смотри примеры в другом проекте своем, или попроси gpt объяснить, вставив в него этот спитч

Остальные два слоя мидлвари и хендлера реализуешь сама, я думаю, но схема та же, есть структура, функция которая создает переменную этой структуры NewMiddleware, NewHandler, NewService, NewRepository

В структуре мидлвари у тебя содержится только токен, с которым нужно сверять хедер, возьми его из конфига, конфиг пускай будет env или yaml

Структура Handler содержит в себе сервис, чтобы использовать его методы в хендлерах, и мидлварю, чтобы подключить ее на нужные ручки

Структура Service содержит в себе репозиторий

структура Репозиторий содержит в себе коннект к базе 